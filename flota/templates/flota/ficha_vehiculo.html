{% extends 'base.html' %}

{% block title %}Ficha Vehículo {{ vehiculo.patente }} - Gestión de Flota{% endblock %}

{% block content %}
<h2 class="mb-4"><i class="bi bi-car-front"></i> Ficha de Vehículo: {{ vehiculo.patente }}</h2>

<div class="row">
    <div class="col-md-6">
        <div class="card mb-3">
            <div class="card-header">
                <h5>Información General</h5>
            </div>
            <div class="card-body">
                <p><strong>Patente:</strong> {{ vehiculo.patente }}</p>
                <p><strong>Marca:</strong> {{ vehiculo.marca }}</p>
                <p><strong>Modelo:</strong> {{ vehiculo.modelo }}</p>
                <p><strong>Tipo:</strong> {{ vehiculo.get_tipo_carroceria_display }}</p>
                <p><strong>Año:</strong> {{ vehiculo.anio_adquisicion }}</p>
                <p><strong>N° Motor:</strong> {{ vehiculo.nro_motor|default:"-" }}</p>
                <p><strong>VIN:</strong> {{ vehiculo.vin|default:"-" }}</p>
                <p><strong>Estado:</strong> 
                    {% if vehiculo.estado == 'Disponible' %}
                        <span class="badge bg-success">{{ vehiculo.estado }}</span>
                    {% elif vehiculo.estado == 'En mantenimiento' %}
                        <span class="badge bg-warning">{{ vehiculo.estado }}</span>
                    {% else %}
                        <span class="badge bg-secondary">{{ vehiculo.estado }}</span>
                    {% endif %}
                </p>
                <p><strong>Kilometraje Actual:</strong> {{ vehiculo.kilometraje_actual|floatformat:0 }} km</p>
                <p><strong>Kilometraje para Mantención:</strong> {{ vehiculo.kilometraje_para_mantencion|floatformat:0 }} km</p>
                <p><strong>Tipo Propiedad:</strong> {{ vehiculo.get_tipo_propiedad_display }}</p>
                <p><strong>Criticidad:</strong> {{ vehiculo.get_criticidad_display }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card mb-3">
            <div class="card-header">
                <h5>Indicadores</h5>
            </div>
            <div class="card-body">
                <p><strong>Costo Total:</strong> ${{ costo_total|floatformat:0 }}</p>
                <p><strong>Costo por Kilómetro:</strong> ${{ costo_por_km|floatformat:2 }}</p>
            </div>
        </div>
        
        {% if alertas %}
        <div class="card mb-3">
            <div class="card-header bg-warning">
                <h5>Alertas Activas</h5>
            </div>
            <div class="card-body">
                {% for alerta in alertas %}
                <div class="alert alert-warning">
                    {{ alerta.descripcion }}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5>Últimos Mantenimientos</h5>
            </div>
            <div class="card-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Fecha Ingreso</th>
                            <th>Tipo</th>
                            <th>Estado</th>
                            <th>Costo</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for mantenimiento in mantenimientos %}
                        <tr>
                            <td>{{ mantenimiento.fecha_ingreso|date:"d/m/Y" }}</td>
                            <td>{{ mantenimiento.get_tipo_mantencion_display }}</td>
                            <td>{{ mantenimiento.get_estado_display }}</td>
                            <td>${{ mantenimiento.costo_total|floatformat:0 }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="mt-3">
    {% if user.rol == 'Administrador' %}
    <a href="{% url 'modificar_vehiculo' vehiculo.patente %}" class="btn btn-warning"><i class="bi bi-pencil"></i> Modificar</a>
    <a href="{% url 'actualizar_estado_vehiculo' vehiculo.patente %}" class="btn btn-info"><i class="bi bi-arrow-repeat"></i> Actualizar Estado</a>
    <a href="{% url 'reporte_historial_unidad' vehiculo.patente %}" class="btn btn-primary"><i class="bi bi-file-text"></i> Ver Historial</a>
    {% endif %}
    <a href="{% url 'listar_flota' %}" class="btn btn-secondary">Volver</a>
</div>
{% endblock %}

