{% extends 'base.html' %}
{% block content %}
<h2>Órdenes de Compra</h2>

<!-- Filtros -->
<form method="get" class="mb-4">
    <div class="row">
        <div class="col-md-4">
            <label for="estado">Estado:</label>
            <select name="estado" id="estado" class="form-control">
                <option value="">Todos</option>
                <option value="Emitida" {% if estado_filter == 'Emitida' %}selected{% endif %}>Emitida</option>
                <option value="Aceptada" {% if estado_filter == 'Aceptada' %}selected{% endif %}>Aceptada</option>
                <option value="Recepcionada" {% if estado_filter == 'Recepcionada' %}selected{% endif %}>Recepcionada</option>
                <option value="Pagada" {% if estado_filter == 'Pagada' %}selected{% endif %}>Pagada</option>
                <option value="Anulada" {% if estado_filter == 'Anulada' %}selected{% endif %}>Anulada</option>
            </select>
        </div>
        <div class="col-md-4">
            <label for="proveedor">Proveedor:</label>
            <select name="proveedor" id="proveedor" class="form-control">
                <option value="">Todos</option>
                {% for proveedor in proveedores %}
                <option value="{{ proveedor.id }}" {% if proveedor_filter == proveedor.id|stringformat:"i" %}selected{% endif %}>
                    {{ proveedor.nombre_fantasia }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-4">
            <label>&nbsp;</label>
            <div>
                <button type="submit" class="btn btn-primary">Filtrar</button>
                <a href="{% url 'listar_ordenes_compra' %}" class="btn btn-secondary">Limpiar</a>
            </div>
        </div>
    </div>
</form>

<!-- Botón para registrar nueva OC -->
<a href="{% url 'registrar_orden_compra' %}" class="btn btn-success mb-3">
    <i class="fas fa-plus"></i> Nueva Orden de Compra
</a>

<!-- Tabla de órdenes de compra -->
<table class="table table-striped">
    <thead>
        <tr>
            <th>N° OC</th>
            <th>Fecha</th>
            <th>Proveedor</th>
            <th>Monto Total</th>
            <th>Estado</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for orden in ordenes %}
        <tr>
            <td>{{ orden.nro_oc }}</td>
            <td>{{ orden.fecha_emision }}</td>
            <td>{{ orden.proveedor.nombre_fantasia }}</td>
            <td>${{ orden.monto_total|floatformat:2 }}</td>
            <td>
                <span class="badge 
                    {% if orden.estado == 'Emitida' %}bg-primary
                    {% elif orden.estado == 'Aceptada' %}bg-info
                    {% elif orden.estado == 'Recepcionada' %}bg-warning
                    {% elif orden.estado == 'Pagada' %}bg-success
                    {% elif orden.estado == 'Anulada' %}bg-danger
                    {% endif %}">
                    {{ orden.estado }}
                </span>
            </td>
            <td>
                <a href="{% url 'detalle_orden_compra' orden.id %}" class="btn btn-sm btn-info">
                    <i class="fas fa-eye"></i>
                </a>
                <a href="{% url 'modificar_orden_compra' orden.id %}" class="btn btn-sm btn-warning">
                    <i class="fas fa-edit"></i>
                </a>
                <a href="{% url 'eliminar_orden_compra' orden.id %}" class="btn btn-sm btn-danger">
                    <i class="fas fa-trash"></i>
                </a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6" class="text-center">No hay órdenes de compra registradas</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
